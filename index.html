    </section>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <li><i class="fas fa-code"></i> <a href="https://www.freecodecamp.org/" target="_blank">FreeCodeCamp</a></li>

    <!-- === Chatbot IA === -->
    <script src="https://cdn.jsdelivr.net/npm/@xenova/transformers/dist/transformers.min.js"></script>

    <div id="itbot-root" aria-live="polite">
      <button id="itbot-toggle" aria-haspopup="dialog" aria-controls="itbot-window" aria-label="Ouvrir le chatbot">
        <i class="fas fa-comments"></i>
      </button>

      <div id="itbot-window" role="dialog" aria-modal="false" aria-labelledby="itbot-title" hidden>
        <header class="itbot-header">
          <div>
            <strong id="itbot-title">Marwen – Aide IT (IA locale)</strong>
            <div class="itbot-subtitle">Wi-Fi, imprimantes, AD, VPN, Outlook, Teams…</div>
          </div>
          <button id="itbot-close" aria-label="Fermer"><i class="fas fa-times"></i></button>
        </header>

        <main id="itbot-messages" class="itbot-scroll" tabindex="0" aria-label="Fil des messages">
          <div class="itbot-msg itbot-bot">
            👋 Bonjour ! Chargement du modèle IA la première fois (quelques centaines de Mo). Posez votre question, je réponds dès que je suis prêt.
          </div>
        </main>

        <div class="itbot-suggestions" aria-label="Suggestions rapides">
          <button class="itbot-chip">Je n’arrive pas à me connecter au Wi-Fi</button>
          <button class="itbot-chip">Mon mot de passe AD ne fonctionne pas</button>
          <button class="itbot-chip">Ajouter une imprimante réseau</button>
          <button class="itbot-chip">Le VPN ne se connecte pas</button>
          <button class="itbot-chip">Outlook ne synchronise pas</button>
          <button class="itbot-chip">Teams caméra/micro</button>
        </div>

        <form id="itbot-form" autocomplete="off">
          <input id="itbot-input" type="text" placeholder="Écrivez votre question…" aria-label="Votre question" required />
          <button type="submit" aria-label="Envoyer"><i class="fas fa-paper-plane"></i></button>
        </form>

        <footer class="itbot-footer">
          <small>Besoin d’un humain ? <a href="#contact" class="itbot-link">Contactez-moi</a></small>
        </footer>
      </div>
    </div>

    <style>
    /* mêmes styles que la version précédente */
    #itbot-root { position: fixed; bottom: 24px; right: 24px; z-index: 9999; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Noto Sans",sans-serif; }
    #itbot-toggle { width:56px; height:56px; border-radius:50%; border:none; cursor:pointer; display:grid; place-items:center; color:#fff; background:linear-gradient(135deg,#2563eb,#0ea5e9); box-shadow:0 10px 20px rgba(0,0,0,.18); }
    #itbot-window { position: fixed; bottom:92px; right:24px; width:min(380px,92vw); max-height:min(70vh,760px); background:#fff; border-radius:16px; border:1px solid #e5e7eb; box-shadow:0 20px 50px rgba(0,0,0,.25); display:flex; flex-direction:column; overflow:hidden; }
    .itbot-header { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:#0ea5e9; color:#fff; }
    .itbot-subtitle{ font-size:.85rem; opacity:.9; }
    #itbot-close { background:transparent; border:none; color:#fff; cursor:pointer; font-size:1.1rem; }
    #itbot-messages { padding:12px; gap:10px; display:flex; flex-direction:column; background:#f8fafc; overflow:auto; }
    .itbot-msg { max-width:88%; padding:10px 12px; border-radius:12px; line-height:1.35; font-size:.95rem; white-space:pre-wrap; }
    .itbot-bot { background:#e2f2ff; border:1px solid #bfdbfe; color:#0f172a; align-self:flex-start; }
    .itbot-user { background:#e5e7eb; border:1px solid #d1d5db; color:#111827; align-self:flex-end; }
    .itbot-suggestions { display:flex; flex-wrap:wrap; gap:8px; padding:8px 12px; background:#fff; border-top:1px solid #eef2f7; }
    .itbot-chip { border:1px solid #dbeafe; background:#f0f9ff; color:#0c4a6e; padding:6px 10px; border-radius:999px; cursor:pointer; font-size:.85rem; }
    #itbot-form { display:flex; gap:8px; padding:10px; background:#fff; border-top:1px solid #eef2f7; }
    #itbot-input { flex:1; padding:10px 12px; border-radius:10px; border:1px solid #cbd5e1; font-size:.95rem; }
    #itbot-form button { width:44px; border-radius:10px; border:1px solid #bae6fd; background:#e0f2fe; color:#075985; cursor:pointer; }
    .itbot-footer { padding:6px 12px 10px; background:#fff; border-top:1px solid #eef2f7; text-align:right; }
    .itbot-link { color:#0ea5e9; text-decoration: underline; }
    </style>

    <script>
    (function(){
      const el = { toggle:null, win:null, close:null, messages:null, form:null, input:null, chips:null };
      let pipe=null, loading=false, ready=false;

      const SYSTEM_PROMPT = `You are "Marwen IT Assistant", a concise and practical IT helpdesk chatbot.
Answer in the user's language (FR if the user writes in French). Focus on Wi-Fi, printers, AD, VPN, Outlook/Teams, Windows.
Give short, step-by-step fixes. Show commands in code blocks. Never ask for passwords.`;

      async function loadModel(){
        if (loading || ready) return;
        loading = true;
        push("⏳ Chargement du modèle IA…", "bot");
        try {
          pipe = await window.transformers.pipeline(
            "text-generation",
            "Xenova/Qwen2.5-0.5B-Instruct",
            { quantized: true }
          );
          ready = true;
          push("✅ IA prête. Posez votre question IT.", "bot");
        } catch(e){
          push("❌ Erreur de chargement du modèle.", "bot");
        }
      }

      async function askAI(text){
        if (!pipe) await loadModel();
        if (!ready) return "Le modèle se charge encore.";
        const prompt = `System: ${SYSTEM_PROMPT}\nUser: ${text}\nAssistant:`;
        const out = await pipe(prompt, { max_new_tokens: 180, temperature: 0.2 });
        const full = (Array.isArray(out)? out[0].generated_text : String(out));
        return full.split("Assistant:").pop().trim();
      }

      function init(){
        el.toggle=document.getElementById('itbot-toggle');
        el.win   =document.getElementById('itbot-window');
        el.close =document.getElementById('itbot-close');
        el.messages=document.getElementById('itbot-messages');
        el.form  =document.getElementById('itbot-form');
        el.input =document.getElementById('itbot-input');
        el.chips =document.querySelectorAll('.itbot-chip');

        const open = ()=>{ el.win.hidden=false; el.input.focus(); loadModel(); };
        const close= ()=>{ el.win.hidden=true; el.toggle.focus(); };

        el.toggle.addEventListener('click', ()=> el.win.hidden ? open() : close());
        el.close.addEventListener('click', close);

        el.form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const q = el.input.value.trim();
          if(!q) return;
          push(q,'user');
          el.input.value='';
          const a = await askAI(q);
          push(a,'bot');
        });

        el.chips.forEach(ch => ch.addEventListener('click', async ()=>{
          const q = ch.textContent.trim();
          push(q,'user');
          if (el.win.hidden) el.win.hidden=false;
          const a = await askAI(q);
          push(a,'bot');
        }));
      }

      function push(text, who){
        const d=document.createElement('div');
        d.className=`itbot-msg itbot-${who}`;
        d.textContent=text;
        el.messages.appendChild(d);
        el.messages.scrollTop=el.messages.scrollHeight;
      }

      if (document.readyState==="loading") document.addEventListener("DOMContentLoaded", init);
      else init();
    })();
    </script>

</body>
</html>
